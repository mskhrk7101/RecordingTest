<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音声認識</title>
</head>

<body>
    <div>
        <button id="start-btn">START</button>
        <button id="stop-btn">STOP</button>
    </div>

    <div>
        音声認識中のテキスト
        <p id="process"></p>
    </div>
    <div>
        認識結果
        <ol id="results">
            </p>
    </div>

    <script>
        const startBtn = document.querySelector("#start-btn");
        const stopBtn = document.querySelector("#stop-btn");
        const process = document.querySelector("#process");
        const results = document.querySelector("#results");

        const recognition = new webkitSpeechRecognition();

        // 日本語を指定
        recognition.lang = "ja-JP";
        // 認識途中でも結果を得る
        recognition.interimResults = true;
        // 認識を終わらせない
        recognition.continuous = true;

        recognition.onresult = (event) => {
            let interimTranscript = ""; // 認識中のテキスト
            for (let i = event.resultIndex; i < event.results.length; i++) {
                let transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    // 音声認識が完了した場合にisFinalがtrueになる
                    var result = document.createElement("li");
                    result.innerText = transcript;
                    results.appendChild(result);
                } else {
                    interimTranscript += transcript;
                }
            }
            process.innerHTML = interimTranscript;
        };

        startBtn.onclick = () => {
            recognition.start();
        };

        stopBtn.onclick = () => {
            recognition.stop();
        };
    </script>
</body>

</html>